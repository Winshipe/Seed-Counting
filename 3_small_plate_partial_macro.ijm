//java -cp ij.jar ij.ImageJ -macro macroname.ijm <image_path>
//macro "Count Seeds" {
//setBatchMode(true);
file_name = getArgument();
if (endsWith(file_name,"xls") || endsWith(file_name,"txt")){
exit();
}
//print(file_path);
//file_name = File.openAsString(file_path); //'C:\\Users\\Eamon\\Documents\\ShiuLab\\seed_images\\8bit_1_98-109005.jpg'
//Current template
ovals = newArray(432,600,2736,2712,3648,552,2640,2808,6984,528,2640,2808,504,3984,2736,2808,3720,3984,2736,2808,6864,3912,2736,2808,456,7440,2736,2808,3744,7368,2736,2808,6912,7344,2736,2808,576,10776,2736,2808,3792,10776,2736,2808,6960,10728,2736,2808);
//scan6 samples: 792,600,2688,2688,3984,504,2727,2836,7247,558,2617,2730,839,3942,2689,2730,4031,4014,2689,2730,7247,4014,2689,2730,839,7374,2737,2730,4055,7374,2737,2730,7199,7398,2737,2730,815,10782,2737,2730,4079,10752,2737,2760,7144,10728,2840,2872);
//Samples: 429,605,2734,2722,3669,605,2734,2722,6837,605,2734,2722,477,3989,2734,2722,3669,3989,2734,2722,6861,3989,2734,2722,477,7421,2734,2722,3645,7421,2734,2722,6813,7421,2734,2722,477,10781,2734,2722,3645,10805,2734,2722,6861,10781,2734,2722);
//552,480,2616,2808,3792,480,2616,2808,6984,480,2616,2808,600,3840,2616,2808,3744,3936,2616,2808,6936,3912,2616,2808,600,7344,2616,2808,3768,7296,2616,2808,6912,7296,2616,2808,624,10728,2616,2808,3744,10704,2616,2808,6888,10680,2736,2856);
//432,504,2784,2808,3600,432,2784,2808,6864,552,2784,2808,456,3912,2784,2808,3576,3864,2784,2808,6792,3912,2784,2808,360,7368,2784,2808,3528,7320,2784,2808,6744,7368,2784,2808,456,10704,2784,2808,3576,10728,2784,2808,6840,10800,2496,2808);
//504,624,2688,2736,3648,576,2688,2736,6864,576,2688,2736,480,4008,2688,2736,3672,3984,2688,2736,6864,3936,2688,2736,648,7368,2688,2736,3768,7416,2688,2736,6936,7344,2760,2760,624,10800,2712,2760,3744,10776,2784,2760,6936,10800,2784,2760);
//565,819,2669,2709,3818,745,2669,2709,6998,782,2669,2709,584,4219,2669,2709,3800,4219,2669,2709,7016,4200,2669,2709,658,7619,2669,2709,3800,7656,2669,2709,6980,7601,2669,2709,621,11019,2669,2709,3855,11093,2669,2709,7053,11093,2669,2709);
// 552,840,2616,2784,3744,816,2616,2784,6936,816,2664,2784,589,4261,2531,2723,3733,4309,2659,2712,6904,4254,2704,2743,496,7686,2744,2743,3702,7694,2754,2739,6918,7670,2754,2739,510,11078,2754,2739,3678,11150,2754,2739,6918,11078,2754,2739);
//1500: 1102,620,3400,3606,4990, 616, 3410, 3580,8992, 632, 3204, 3576,1104, 4904, 3371, 3543,4939,4893,3606,3629,8936,4892,3354,3629,1125,9165,3377,3629,4916,9166,3629,3651,8891,9143,3445,3651,1103,13416,3359,3606,4962,13393,3515,3698,8891,13393,3491,3698);
//Previous Templates
//Samples 827,862,2653,2648,4007,874,2635,2646,7205,940,2635,2646,725,4238,2628,2664,3943,4298,2614,2620,7189,4376,2614,2620,664,7636,2635,2646,3832,7724,2635,2646,7040,7828,2635,2646,528,11100,2635,2646,3816,11140,2635,2646,7008,11172,2579,2675);
//1000:  192,411,2448,2493,2880,435,2448,2493,5544,363,2448,2493,216,3219,2448,2493,2904,3243,2448,2493,5544,3219,2448,2493,240,6051,2448,2493,2880,6075,2448,2493,5568,6051,2448,2493,216,8931,2448,2493,2856,8931,2448,2493,5496,8931,2448,2493);
//500: 96,168,1236,1260,1416,144,1236,1260,2748,168,1236,1260,72,1560,1236,1260,1404,1584,1236,1260,2748,1596,1236,1260,72,3000,1236,1260,1416,3000,1236,1260,2736,3012,1236,1260,96,4416,1236,1260,1392,4428,1236,1260,2736,4428,1236,1260);
//1500: 352,608,3520,3616,4384,576,3520,3616,8320,640,3520,3616,256,4896,3520,3616,4416,4896,3520,3616,8352,4864,3520,3616,384,9120,3520,3616,4320,9088,3520,3616,8352,9120,3520,3616,320,13376,3520,3616,4288,13440,3520,3616,8320,13408,3520,3616);
//1000: 528,792,2856,2880,3744,864,2856,2880,6888,888,2856,2880,528,4224,2856,2880,3720,4272,2856,2880,6888,4272,2856,2880,456,7656,2856,2880,3696,7656,2856,2880,6816,7728,2856,2880,384,11064,2856,2880,3600,11088,2856,2880,6816,11112,2856,2880);
//504,648,2784,2928,3648,648,2784,2928,6888,600,2784,2928,480,4080,2784,2928,3720,4056,2784,2928,6864,3984,2784,2928,528,7488,2784,2928,3720,7440,2784,2928,6864,7416,2784,2928,552,10872,2784,2928,3720,10872,2784,2928,6960,10872,2784,2928);
//1500:  416,640,3456,3648,4416,672,3456,3648,8416,608,3456,3648,448,4864,3456,3648,4448,4800,3456,3648,8352,4928,3456,3648,320,9120,3456,3648,4416,9184,3456,3648,8416,9152,3456,3648,384,13440,3456,3648,4352,13408,3456,3648,8352,13408,3456,3648);
//1500:  288,288,3776,3840,4320,288,3776,3840,8256,320,3776,3840,192,4480,3776,3840,4256,4544,3776,3840,8256,4544,3776,3840,288,8800,3776,3840,4224,8832,3776,3840,8288,8832,3776,3840,320,13056,3776,3840,4288,13088,3776,3840,8304,13072,3776,3840);
//500:  180,144,1164,1200,1548,144,1164,1200,2832,156,1164,1200,156,1560,1164,1200,1500,1560,1164,1200,2832,1572,1164,1200,132,2976,1164,1200,1476,2976,1164,1200,2832,2988,1164,1200,144,4404,1164,1200,1464,4416,1164,1200,2796,4428,1164,1200);
//500:  132,204,1176,1200,1452,204,1176,1200,2772,204,1176,1200,120,1620,1176,1200,1452,1608,1176,1200,2808,1632,1176,1200,108,3012,1176,1200,1428,3036,1176,1200,2748,3036,1176,1200,96,4452,1176,1200,1452,4476,1176,1200,2772,4488,1176,1200);
//1500: 384,576,3528,3600,4344,600,3528,3600,8328,696,3528,3600,360,4824,3528,3600,4368,4872,3528,3600,8352,4872,3528,3600,312,9168,3528,3600,4344,9120,3528,3600,8352,9144,3528,3600,312,13440,3528,3600,4320,13416,3528,3600,8352,13416,3528,3600);
//1000: -48,384,2208,2376,2616,384,2208,2376,5208,456,2208,2376,48,3240,2208,2376,2568,3240,2208,2376,5256,3264,2208,2376,96,6072,2208,2376,2568,6048,2208,2376,5208,6096,2208,2376,96,8928,2208,2376,2568,8952,2208,2376,5256,8952,2208,2376);
//1500 dpi coordinates: 704,352,3520,3648,4736,448,3520,3648,8768,544,3520,3648,736,4640,3520,3648,4608,4736,3520,3648,8608,4800,3520,3648,544,8832,3520,3648,4512,8928,3520,3648,8544,9088,3520,3648,480,13120,3520,3648,4352,13152,3520,3648,8448,13376,3520,3648); 
//1000 dpi coordinates: 312,216,2376,2424,3000,240,2376,2424,5616,240,2376,2424,312,3048,2376,2424,2904,3072,2376,2424,5592,3072,2376,2424,240,5856,2376,2424,2832,5880,2376,2424,5544,5952,2376,2424,264,8736,2376,2424,2880,8784,2376,2424,5568,8760,2376,2424);  
//500 dpi coordinates: 184,104,1147,1228,1512,144,1188,1164,2832,144,1188,1164,168,1548,1188,1164,1500,1560,1188,1164,2832,1572,1188,1164,144,2988,1188,1164,1488,2988,1188,1164,2820,3000,1188,1164,156, 4404, 1188, 1164,1476, 4404, 1188, 1164,2796, 4416, 1188, 1164); 
//1000: 696,264,2304,2376,3360, 288, 2328, 2376,6083,330,2221,2310,696,3144,2208,2304,3334,3130,2306,2366,6024,3168,2232,2232);
//500:  348,120,1152,1212,1680,108,1155,1212,2995,127,1193,1196,348,1584,1152,1176,1644,1560,1188,1188,2988,1572,1200,1176);
//1000:  456,600,2736,2640,3696,592,2704,2656,6877,646,2699,2619,456,4056,2712,2616,3696,3984,2832,2664,6840,3912,2808,2760,552,7488,2640,2664,3648,7440,2784,2664,6888,7368,2688,2688,552,10872,2784,2592,3762,10818,2694,2670,6925,10841,2723,2671);
//1000: (480,517,2724,2699,3672,528,2712,2688,6801,518,2727,2764,448,3939,2696,2685,3627,3901,2781,2699,6811,3909,2741,2715,556,7367,2600,2677,3657,7357,2643,2711,6848,7321,2668,2699,468,10739,2664,2676,3609,10744,2823,2755,6826,10768,2783,2735);


function count_seeds(file_name,ovals) {
        //print(file_path);
        //print(file_name);
        open( file_name);/*               v      1500 DPI       v v 2000 DPI             v  v  500 DPI            v v      1000 DPI        v*/
        makeLine(2256, 480, 2256, 3336);//1848, 648, 1872, 3576);//2496, 352, 2496, 4000);//(480, 1116, 1356, 312);//1080, 2400, 2448, 408);//Scale
        run("Set Scale...", "known=60 unit=unit");
        setAutoThreshold("Default");
        setThreshold(50, 140);
        //waitForUser("Say CHEESE!");
        //print(toString(lastIndexOf(file_name,'\\')));
        //print(toString(indexOf(file_name,'.bmp')));
        path = substring(file_name,0,lastIndexOf(file_name,"\\"));
        new_path = path+'\\counts\\';
        new_base_name = substring(file_name,(lastIndexOf(file_name,'\\')+1),indexOf(file_name,'.bmp'));
        File.makeDirectory(new_path);
        savename = new_path+new_base_name+"_results_";
        for(i=0;i<ovals.length;i+=4){
            makeOval(ovals[i+0],ovals[i+1],ovals[i+2],ovals[i+3]);
            //waitForUser("Say CHEESE!");/**/ 
			results_name = savename+toString(i/4,0);
			//print(i/4);
			/*if (i==0){
			    run("Analyze Particles...", "size=0.06-0.18 circularity=0.25-1.00 clear display");
				saveAs("Results", results_name+'.xls');
			}
			else{
				run("Analyze Particles...", "size=0.06-infinity circularity=0.25-1.00 clear display");
				IJ.renameResults("Results");
				String.copyResults();
				//waitForUser("");
				table = String.paste();
				File.saveString(table,results_name+'.txt');*/
			run("Analyze Particles...","size=0.06-infinity circularity=0.25-1.00 display clear summarize add");
			//}
	       /* if(i%8==0)
			   {waitForUser("Say CHEESE!");}         
            *///File.saveString(savename,'C:\\Users\\Eamon\\Documents\\ShiuLab\\seed_images\\test.txt')
        };
        saveAs("Results",savename+".xls");
        //setBatchMode(false);
        run("Close");
        close("*");
        exit();
}
count_seeds(file_name,ovals);

